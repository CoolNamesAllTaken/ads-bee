Version 4
SHEET 1 1436 680
WIRE -496 -176 -496 -192
WIRE -496 -80 -496 -96
WIRE -800 -16 -800 -32
WIRE 640 0 640 -16
WIRE 640 0 336 0
WIRE 224 16 144 16
WIRE 144 48 144 16
WIRE 288 48 256 48
WIRE 256 64 256 48
WIRE 288 64 288 48
WIRE 336 64 336 0
WIRE -800 80 -800 64
WIRE 464 80 448 80
WIRE 640 96 640 0
WIRE 640 96 528 96
WIRE 224 112 224 16
WIRE 272 112 224 112
WIRE 384 112 352 112
WIRE 464 112 384 112
WIRE 144 144 144 128
WIRE 496 144 496 128
WIRE -112 240 -160 240
WIRE 0 240 -32 240
WIRE 48 240 0 240
WIRE 160 240 128 240
WIRE 208 240 160 240
WIRE 272 240 208 240
WIRE 384 240 384 112
WIRE 384 240 352 240
WIRE -160 272 -160 240
WIRE 0 272 0 240
WIRE 160 272 160 240
WIRE 288 320 288 288
WIRE 640 320 640 96
WIRE 640 320 288 320
WIRE -160 384 -160 352
WIRE 0 384 0 336
WIRE 160 384 160 352
FLAG 0 384 0
FLAG 496 144 0
FLAG 160 384 0
FLAG -160 384 0
FLAG -800 -32 in
FLAG 448 80 in
FLAG -800 80 0
FLAG -496 -192 3v3
FLAG -496 -80 0
FLAG 208 240 mtl
FLAG 640 -96 3v3
FLAG 496 64 3v3
FLAG 336 288 0
FLAG 144 144 0
FLAG 256 64 0
SYMBOL voltage -160 256 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 {v_dd} 0 10n 10n {t_on} {t_period})
SYMBOL res -16 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL cap -16 272 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC=v_mtl
SYMATTR InstName C1
SYMATTR Value 0.1µ
SYMBOL res 144 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 144 256 R0
SYMATTR InstName R3
SYMATTR Value 200k
SYMBOL voltage -800 -32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(2.2 1.8 0 100n 100n 0.5u 1u)
SYMBOL voltage -496 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value {v_dd}
SYMBOL OpAmps\\UniversalOpAmp2 496 96 R0
SYMATTR InstName U1
SYMATTR Value2 Avol=1Meg GBW=10G Slew=10G
SYMBOL res 624 -112 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL sw 256 240 R270
WINDOW 3 -19 94 VRight 2
SYMATTR InstName S1
SYMATTR Value SN74LVC1G3157
SYMBOL sw 256 112 M90
WINDOW 3 -139 100 VLeft 2
SYMATTR InstName S2
SYMATTR Value SN74LVC1G3157
SYMBOL voltage 144 32 R0
SYMATTR InstName V4
SYMATTR Value 2.0
TEXT -296 184 Left 2 ;RC Lowpass f_c=159Hz
TEXT -416 -152 Left 2 !.param f_sw=125k v_mtl=3.1 v_dd=3.3 t_period={1/f_sw} t_on={v_mtl/v_dd*t_period} t_off={1-t_on}
TEXT -688 280 Left 2 !.tran 0 1m 0 10n
TEXT -72 416 Left 2 ;The big danger is that out could pull mtl up too far!
TEXT 696 376 Left 2 !.model custom_zener ako: 1N750 bv=2.2\n.model SN74LVC1G3157 SW(Ron=6 Roff=1G Vt=1.65 Vh=0.66)
